{"ast":null,"code":"var _jsxFileName = \"/Users/clementine/Desktop/02\\u77E5\\u4E4E\\u65E5\\u62A5/zhihu/src/views/Home.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport HomeHead from \"../components/HomeHead\";\nimport _ from '../assets/utils';\nimport './Home.less';\nimport { Swiper, Image, Divider, DotLoading } from 'antd-mobile';\nimport { Link } from 'react-router-dom';\nimport api from '../api';\nimport NewsItem from \"../components/NewsItem\";\nimport SkeletonAgain from \"../components/SkeletonAgain\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Home = function Home() {\n  _s();\n  /* 创建所需状态 */\n  // formatTime参数如果不是字符串，就使用当前时间的字符串，{0}{1}{2}表示返回年月日\n  let [today, setToday] = useState(_.formatTime(null, \"{0}{1}{2}\")),\n    [bannerData, setBannerData] = useState([]),\n    [newsList, setNewsList] = useState([]);\n  let loadMore = useRef();\n\n  /* 第一次渲染完毕:向服务器发送数据请求 */\n  useEffect(() => {\n    (async () => {\n      try {\n        let {\n          date,\n          stories,\n          top_stories\n        } = await api.queryNewsLatest();\n        setToday(date);\n        setBannerData(top_stories);\n        // 更新新闻列表状态\n        newsList.push({\n          date,\n          stories\n        });\n        setNewsList([...newsList]);\n      } catch (_) {}\n    })();\n  }, []);\n\n  /* 第一次渲染完毕:设置监听器,实现触底加载 */\n  useEffect(() => {\n    // IntersectionObserver用于检测一个元素是否离开了另一个元素的可视区域\n    // 创建IntersectionObserver对象时第二个参数可以是一个配置对象，里面包含root、threshold或者rootMargin的值\n    // root根元素，判断可见性的参照元素\n    // rootMargin根边距，为正数px相当于提前对应像素触发回调函数，为负数px相当于延后对应像素触发回调函数\n    // changes数组包含了所有被观察元素的交叉信息。每个元素都是一个IntersectionObserverEntry对象\n    // 根据被观察元素发生交叉的时间戳排序\n    let ob = new IntersectionObserver(async changes => {\n      let {\n        isIntersecting\n      } = changes[0];\n      if (isIntersecting) {\n        // 加载更多的按钮出现在视口中「也就是触底了」\n        try {\n          let time = newsList[newsList.length - 1]['date'];\n          let res = await api.queryNewsBefore(time);\n          newsList.push(res);\n          // 状态变量的地址不变，useEffect不会更新，视图也不更新，所以需要用一个新变量设置状态\n          setNewsList([...newsList]);\n        } catch (_) {}\n      }\n    });\n    let loadMoreBox = loadMore.current;\n    // 可以监测多个元素，只要把每个元素的引用作为参数传入就可以了。\n    // 例如：ob.observe(element1); ob.observe(element2);\n    ob.observe(loadMore.current);\n\n    // 组件完全销毁时触发这个回调函数，手动销毁监听器\n    return () => {\n      // ob.unobserve(lloadMore.current) 不生效，因为loadMore.current已经是null\n      // 可以提前let loadMoreBox = loadMore.current存这个dom\n      ob.unobserve(loadMoreBox); //loadMore.current=null\n      ob = null;\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"home-box\",\n    children: [/*#__PURE__*/_jsxDEV(HomeHead, {\n      today: today\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"swiper-box\",\n      children: bannerData.length > 0 ? /*#__PURE__*/_jsxDEV(Swiper, {\n        autoplay: true,\n        loop: true,\n        children: bannerData.map(item => {\n          let {\n            id,\n            image,\n            title,\n            hint\n          } = item;\n          return /*#__PURE__*/_jsxDEV(Swiper.Item, {\n            children: /*#__PURE__*/_jsxDEV(Link, {\n              to: {\n                pathname: `/detail/${id}`\n              },\n              children: [/*#__PURE__*/_jsxDEV(Image, {\n                src: image,\n                lazy: true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 83,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"desc\",\n                children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                  className: \"title\",\n                  children: title\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 85,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"author\",\n                  children: hint\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 86,\n                  columnNumber: 33\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 84,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 82,\n              columnNumber: 25\n            }, this)\n          }, id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 28\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 38\n      }, this) : null\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 9\n    }, this), newsList.length === 0 ? /*#__PURE__*/_jsxDEV(SkeletonAgain, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 13\n    }, this) :\n    /*#__PURE__*/\n    // 空标签包裹 避免多个根标签\n    _jsxDEV(_Fragment, {\n      children: newsList.map((item, index) => {\n        let {\n          date,\n          stories\n        } = item;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"news-box\",\n          children: [index !== 0 ? /*#__PURE__*/_jsxDEV(Divider, {\n            contentPosition: \"left\",\n            children: _.formatTime(date, '{1}月{2}日')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 44\n          }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"list\",\n            children: stories.map(cur => {\n              return /*#__PURE__*/_jsxDEV(NewsItem, {\n                info: cur\n              }, cur.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 109,\n                columnNumber: 44\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 107,\n            columnNumber: 29\n          }, this)]\n        }, date, true, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 32\n        }, this);\n      })\n    }, void 0, false), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loadmore-box\",\n      ref: loadMore,\n      style: {\n        display: newsList.length === 0 ? 'none' : 'block'\n      },\n      children: [/*#__PURE__*/_jsxDEV(DotLoading, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 13\n      }, this), \"\\u6570\\u636E\\u52A0\\u8F7D\\u4E2D\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 12\n  }, this);\n};\n_s(Home, \"kk1hmCcCgIDG0mPcOon/yejy7HU=\");\n_c = Home;\nexport default Home;\nvar _c;\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"names":["React","useState","useEffect","useRef","HomeHead","_","Swiper","Image","Divider","DotLoading","Link","api","NewsItem","SkeletonAgain","Home","today","setToday","formatTime","bannerData","setBannerData","newsList","setNewsList","loadMore","date","stories","top_stories","queryNewsLatest","push","ob","IntersectionObserver","changes","isIntersecting","time","length","res","queryNewsBefore","loadMoreBox","current","observe","unobserve","map","item","id","image","title","hint","pathname","index","cur","display"],"sources":["/Users/clementine/Desktop/02知乎日报/zhihu/src/views/Home.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport HomeHead from \"../components/HomeHead\";\nimport _ from '../assets/utils';\nimport './Home.less';\nimport { Swiper, Image, Divider, DotLoading } from 'antd-mobile';\nimport { Link } from 'react-router-dom';\nimport api from '../api';\nimport NewsItem from \"../components/NewsItem\";\nimport SkeletonAgain from \"../components/SkeletonAgain\";\n\nconst Home = function Home() {\n    /* 创建所需状态 */\n    // formatTime参数如果不是字符串，就使用当前时间的字符串，{0}{1}{2}表示返回年月日\n    let [today, setToday] = useState(_.formatTime(null, \"{0}{1}{2}\")),\n        [bannerData, setBannerData] = useState([]),\n        [newsList, setNewsList] = useState([]);\n    let loadMore = useRef();\n\n    /* 第一次渲染完毕:向服务器发送数据请求 */\n    useEffect(() => {\n        (async () => {\n            try {\n                let { date, stories, top_stories } = await api.queryNewsLatest();\n                setToday(date);\n                setBannerData(top_stories);\n                // 更新新闻列表状态\n                newsList.push({\n                    date,\n                    stories\n                });\n                setNewsList([...newsList]);\n            } catch (_) { }\n        })();\n    }, []);\n\n    /* 第一次渲染完毕:设置监听器,实现触底加载 */\n    useEffect(() => {\n        // IntersectionObserver用于检测一个元素是否离开了另一个元素的可视区域\n        // 创建IntersectionObserver对象时第二个参数可以是一个配置对象，里面包含root、threshold或者rootMargin的值\n        // root根元素，判断可见性的参照元素\n        // rootMargin根边距，为正数px相当于提前对应像素触发回调函数，为负数px相当于延后对应像素触发回调函数\n        // changes数组包含了所有被观察元素的交叉信息。每个元素都是一个IntersectionObserverEntry对象\n        // 根据被观察元素发生交叉的时间戳排序\n        let ob = new IntersectionObserver(async changes => {\n            let { isIntersecting } = changes[0];\n            if (isIntersecting) {\n                // 加载更多的按钮出现在视口中「也就是触底了」\n                try {\n                    let time = newsList[newsList.length - 1]['date'];\n                    let res = await api.queryNewsBefore(time);\n                    newsList.push(res);\n                    // 状态变量的地址不变，useEffect不会更新，视图也不更新，所以需要用一个新变量设置状态\n                    setNewsList([...newsList]);\n                } catch (_) { }\n            }\n        });\n        let loadMoreBox = loadMore.current;\n        // 可以监测多个元素，只要把每个元素的引用作为参数传入就可以了。\n        // 例如：ob.observe(element1); ob.observe(element2);\n        ob.observe(loadMore.current);\n\n        // 组件完全销毁时触发这个回调函数，手动销毁监听器\n        return () => {\n            // ob.unobserve(lloadMore.current) 不生效，因为loadMore.current已经是null\n            // 可以提前let loadMoreBox = loadMore.current存这个dom\n            ob.unobserve(loadMoreBox); //loadMore.current=null\n            ob = null;\n        };\n    }, []);\n\n    return <div className=\"home-box\">\n        {/* 头部 */}\n        <HomeHead today={today} />\n\n        {/* 轮播图 */}\n        <div className=\"swiper-box\">\n            {/* bannerData不为空才渲染Swiper */}\n            {bannerData.length > 0 ? <Swiper autoplay={true} loop={true}>\n                {bannerData.map(item => {\n                    let { id, image, title, hint } = item;\n                    return <Swiper.Item key={id}>\n                        <Link to={{ pathname: `/detail/${id}` }}>\n                            <Image src={image} lazy />\n                            <div className=\"desc\">\n                                <h3 className=\"title\">{title}</h3>\n                                <p className=\"author\">{hint}</p>\n                            </div>\n                        </Link>\n                    </Swiper.Item>;\n                })}\n            </Swiper> : null}\n        </div>\n\n        {/* 新闻列表 */}\n        {newsList.length === 0 ?\n            <SkeletonAgain /> : \n            // 空标签包裹 避免多个根标签\n            <>\n                {\n                    newsList.map((item, index) => {\n                        let { date, stories } = item;\n                        return <div className=\"news-box\" key={date}>\n                            {/* 当天的新闻不需要标识日期 */}\n                            {index !== 0 ? <Divider contentPosition=\"left\">\n                                {_.formatTime(date, '{1}月{2}日')}\n                            </Divider> : null}\n                            <div className=\"list\">\n                                {stories.map(cur => {\n                                    return <NewsItem key={cur.id} info={cur} />;\n                                })}\n                            </div>\n                        </div>;\n                    })\n                }\n            </>\n        }\n\n        {/* 加载更多 */}\n        <div className=\"loadmore-box\" ref={loadMore}\n            style={{\n                display: newsList.length === 0 ? 'none' : 'block'\n            }} >\n            <DotLoading />\n            数据加载中\n        </div>\n    </div >;\n};\nexport default Home;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}